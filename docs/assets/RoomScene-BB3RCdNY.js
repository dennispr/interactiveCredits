const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-D_ALOtkQ.js","./pixi-Cnp5aGhx.js","./index-Bmr7sqCh.css"])))=>i.map(i=>d[i]);
var d=Object.defineProperty;var m=(y,c,t)=>c in y?d(y,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[c]=t;var s=(y,c,t)=>m(y,typeof c!="symbol"?c+"":c,t);import{C as u,G as a,T as p,_ as g}from"./pixi-Cnp5aGhx.js";import{B as P,G as i}from"./index-D_ALOtkQ.js";class x extends P{constructor(t){super(t);s(this,"patronManager");s(this,"floor");s(this,"roomNumber");s(this,"patron");s(this,"roomContainer");s(this,"npcSprite");s(this,"playerSprite");s(this,"itemSprite");s(this,"posterSprite");s(this,"dialogContainer");s(this,"playerPosition",{x:50,y:0});s(this,"npcPosition",{x:400,y:0});s(this,"npcDirection",1);s(this,"npcPaceMin",300);s(this,"npcPaceMax",500);s(this,"groundLevel",0);s(this,"platformHeight",20);s(this,"isShowingDialog",!1);s(this,"isNearNPC",!1);s(this,"isNearItem",!1);s(this,"isNearPoster",!1);s(this,"isNearDoor",!1);s(this,"exitPopup");s(this,"interactionPrompt")}async enter(){!this.patronManager||this.floor===void 0||this.roomNumber===void 0||(this.patron=this.patronManager.getPatronInRoom(this.floor,this.roomNumber),this.patron&&(this.createRoomLayout(),this.createRoomElements(),this.createPlayer(),this.createNPC(),this.createUI(),this.positionElements()))}createRoomLayout(){this.roomContainer=new u,this.groundLevel=this.layout.roomHeight-this.platformHeight-20;const t=new a;t.rect(0,0,this.layout.roomWidth,this.layout.roomHeight*.7).fill(i.PLACEHOLDER_COLORS.BACKGROUND);const e=new a;e.rect(0,this.groundLevel,this.layout.roomWidth,this.platformHeight).fill(i.PLACEHOLDER_COLORS.FLOOR);const o=new a;o.rect(0,0,20,this.layout.roomHeight).fill(i.PLACEHOLDER_COLORS.WALL);const h=new a;h.rect(this.layout.roomWidth-20,0,20,this.layout.roomHeight).fill(i.PLACEHOLDER_COLORS.WALL);const r=new a;r.rect(0,0,this.layout.roomWidth,20).fill(i.PLACEHOLDER_COLORS.WALL);const n=new a;n.rect(0,this.groundLevel-60,20,60).fill(i.PLACEHOLDER_COLORS.BACKGROUND);const l=new a;l.rect(5,this.groundLevel-65,10,70).fill(i.PLACEHOLDER_COLORS.DOOR),this.roomContainer.addChild(t,e,o,h,r,n,l),this.roomContainer.x=(this.layout.screenWidth-this.layout.roomWidth)/2,this.roomContainer.y=(this.layout.screenHeight-this.layout.roomHeight)/2,this.container.addChild(this.roomContainer)}createRoomElements(){this.itemSprite=new a().rect(0,0,this.layout.itemSize,this.layout.itemSize).fill(i.PLACEHOLDER_COLORS.ITEM),this.posterSprite=new a().rect(0,0,this.layout.posterWidth,this.layout.posterHeight).fill(i.PLACEHOLDER_COLORS.POSTER);const t=new a().rect(-this.layout.posterFrameBorder,-this.layout.posterFrameBorder,this.layout.posterWidth+this.layout.posterFrameBorder*2,this.layout.posterHeight+this.layout.posterFrameBorder*2).stroke({width:2,color:9127187});this.posterSprite.addChild(t),this.roomContainer.addChild(this.itemSprite,this.posterSprite)}createPlayer(){this.playerSprite=new a().rect(0,0,this.layout.playerWidth,this.layout.playerHeight).fill(i.UI_COLORS.ACCENT),this.playerSprite.circle(this.layout.playerWidth/2,this.layout.characterFaceY,this.layout.characterFaceRadius).fill(0),this.roomContainer.addChild(this.playerSprite)}createNPC(){this.npcSprite=new a().rect(0,0,this.layout.npcWidth,this.layout.npcHeight).fill(i.PLACEHOLDER_COLORS.NPC),this.npcSprite.circle(this.layout.npcWidth/2,this.layout.characterFaceY,this.layout.characterFaceRadius).fill(0);const t=this.getTierColor(this.patron.tier);this.npcSprite.circle(this.layout.npcWidth/2,this.layout.npcHeight-this.layout.tierIndicatorOffset,this.layout.tierIndicatorRadius).fill(t),this.roomContainer.addChild(this.npcSprite)}getTierColor(t){switch(t){case"bronze":return 13467442;case"silver":return 12632256;case"gold":return 16766720;case"diamond":return 12186367;default:return 16777215}}createUI(){const t=new p({text:`${this.patron.name}'s Workshop`,style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.SUBTITLE),fill:i.UI_COLORS.TEXT,align:"center",fontWeight:"bold"}});t.anchor.set(.5),t.x=this.layout.centerX(),t.y=this.layout.margin;const e=new a().rect(0,0,this.layout.roomControlsBackgroundWidth,this.layout.roomControlsBackgroundHeight).fill(0),o=new p({text:"Use ← → to move, SPACE to interact, ESC to leave",style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.SMALL),fill:16777215,align:"center"}});e.x=this.layout.centerX()-this.layout.roomControlsBackgroundWidth/2,e.y=this.layout.screenHeight-this.layout.margin-this.layout.roomControlsBackgroundHeight,o.anchor.set(.5),o.x=this.layout.centerX(),o.y=this.layout.screenHeight-this.layout.margin-this.layout.roomControlsBackgroundHeight/2,this.interactionPrompt=new p({text:"Press SPACE to interact",style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.UI),fill:i.UI_COLORS.ACCENT,align:"center",fontWeight:"bold"}}),this.interactionPrompt.anchor.set(.5),this.interactionPrompt.x=this.layout.centerX(),this.interactionPrompt.y=this.layout.getFontSize(80),this.interactionPrompt.visible=!1,this.container.addChild(t,e,o,this.interactionPrompt)}positionElements(){this.playerPosition.x=40,this.playerPosition.y=this.groundLevel-this.layout.playerHeight,this.npcPosition.x=this.layout.roomWidth*.5,this.npcPosition.y=this.groundLevel-this.layout.npcHeight,this.npcPaceMin=this.layout.roomWidth*.3,this.npcPaceMax=this.layout.roomWidth*.7,this.itemSprite.x=this.layout.roomWidth*.25,this.itemSprite.y=this.groundLevel-this.layout.itemSize,this.posterSprite.x=this.layout.roomWidth*.75-this.layout.posterWidth/2,this.posterSprite.y=this.layout.roomHeight*.2,this.updateSpritePositions()}updateSpritePositions(){this.playerSprite.x=this.playerPosition.x,this.playerSprite.y=this.playerPosition.y,this.npcSprite.x=this.npcPosition.x,this.npcSprite.y=this.npcPosition.y}update(t){this.isShowingDialog||(this.handleMovement(t),this.updateNPCMovement(t)),this.checkInteractions()}handleMovement(t){const e=this.layout.playerSpeed*(t/60),o={left:this.layout.roomSideMargin,right:this.layout.roomWidth-this.layout.playerWidth-this.layout.roomSideMargin};this.isKeyPressed("ArrowLeft")&&(this.playerPosition.x=Math.max(o.left,this.playerPosition.x-e)),this.isKeyPressed("ArrowRight")&&(this.playerPosition.x=Math.min(o.right,this.playerPosition.x+e)),this.playerPosition.y=this.groundLevel-this.layout.playerHeight,this.updateSpritePositions()}updateNPCMovement(t){const e=this.layout.npcSpeed*(t/60);this.npcPosition.x+=e*this.npcDirection,this.npcPosition.x>=this.npcPaceMax?(this.npcDirection=-1,this.npcPosition.x=this.npcPaceMax):this.npcPosition.x<=this.npcPaceMin&&(this.npcDirection=1,this.npcPosition.x=this.npcPaceMin),this.npcPosition.y=this.groundLevel-this.layout.npcHeight,this.updateSpritePositions()}checkInteractions(){const t=this.layout.interactionDistance,e={x:0,y:this.groundLevel-60,width:25,height:60},o=this.playerPosition.x>=e.x&&this.playerPosition.x<=e.x+e.width&&this.playerPosition.y+this.layout.playerHeight>=e.y&&this.playerPosition.y<=e.y+e.height;this.isNearDoor=o;const h=Math.abs(this.playerPosition.x-this.npcPosition.x);this.isNearNPC=h<t;const r=Math.abs(this.playerPosition.x-this.itemSprite.x);this.isNearItem=r<t;const n=Math.abs(this.playerPosition.x-this.posterSprite.x);this.isNearPoster=n<t,this.isNearDoor&&!this.exitPopup?(this.interactionPrompt.visible=!0,this.interactionPrompt.text="Press SPACE to leave room"):this.isNearNPC||this.isNearItem||this.isNearPoster?(this.interactionPrompt.visible=!0,this.isNearNPC?this.interactionPrompt.text=`Press SPACE to talk to ${this.patron.name}`:this.isNearItem?this.interactionPrompt.text="Press SPACE to examine item":this.isNearPoster&&(this.interactionPrompt.text="Press SPACE to view poster")):this.interactionPrompt.visible=!1}handleKeyDown(t){if(super.handleKeyDown(t),this.exitPopup){if(t==="Enter"||t==="Space"){this.confirmExit();return}else if(t==="Escape"){this.cancelExit();return}}switch(t){case"Space":this.handleInteraction();break;case"Escape":this.isShowingDialog?this.hideDialog():this.exitRoom();break}}handleInteraction(){if(this.isShowingDialog){this.hideDialog();return}this.isNearDoor?this.showExitPopup():this.isNearNPC?this.showDialog(this.patron.dialogText):this.isNearItem?this.showDialog(`This is ${this.patron.name}'s special item. It holds great meaning to them!`):this.isNearPoster&&this.showDialog(`A beautiful poster chosen by ${this.patron.name}. It reflects their personality and interests.`)}showDialog(t){this.isShowingDialog=!0,this.dialogContainer=new u;const e=this.layout.screenWidth*.8,o=this.layout.screenHeight*.2,h=new a().roundRect(0,0,e,o,10).fill(0,.8).stroke({width:2,color:i.UI_COLORS.PRIMARY}),r=new p({text:this.wrapText(t,Math.floor(e/this.layout.getFontSize(10))),style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.BODY),fill:i.UI_COLORS.TEXT,align:"left",wordWrap:!0,wordWrapWidth:e-40}});r.x=20,r.y=20;const n=new p({text:"Press SPACE or ESC to close",style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.SMALL),fill:i.UI_COLORS.SECONDARY,align:"right"}});n.anchor.set(1,1),n.x=e-20,n.y=o-10,this.dialogContainer.addChild(h,r,n),this.dialogContainer.x=this.layout.centerX(e),this.dialogContainer.y=this.layout.screenHeight-o-this.layout.margin,this.container.addChild(this.dialogContainer)}hideDialog(){this.dialogContainer&&(this.container.removeChild(this.dialogContainer),this.dialogContainer.destroy()),this.isShowingDialog=!1}showExitPopup(){const t=new u,e=new a().rect(0,0,this.layout.screenWidth,this.layout.screenHeight).fill(0,.7),o=400*this.layout.scale,h=150*this.layout.scale,r=new a().rect(0,0,o,h).fill(2899536).stroke({width:3,color:i.UI_COLORS.ACCENT});r.x=this.layout.centerX()-o/2,r.y=this.layout.centerY()-h/2;const n=new p({text:"Leave Room?",style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.SUBTITLE),fill:i.UI_COLORS.TEXT,align:"center",fontWeight:"bold"}});n.anchor.set(.5),n.x=o/2,n.y=40*this.layout.scale;const l=new p({text:"Press ENTER to return to hallway, ESC to stay",style:{fontFamily:i.DEFAULT_FONT_FAMILY,fontSize:this.layout.getFontSize(i.FONT_SIZES.SMALL),fill:i.UI_COLORS.SECONDARY,align:"center"}});l.anchor.set(.5),l.x=o/2,l.y=90*this.layout.scale,r.addChild(n,l),t.addChild(e,r),this.container.addChild(t),this.exitPopup=t}confirmExit(){this.exitPopup&&(this.container.removeChild(this.exitPopup),this.exitPopup=void 0),this.exitRoom()}cancelExit(){this.exitPopup&&(this.container.removeChild(this.exitPopup),this.exitPopup=void 0)}wrapText(t,e){const o=t.split(" "),h=[];let r="";for(const n of o)(r+n).length<=e?r+=(r?" ":"")+n:(r&&h.push(r),r=n);return r&&h.push(r),h.join(`
`)}async exitRoom(){const t=this.app.sceneManager;if(t){const{HallwayScene:e}=await g(async()=>{const{HallwayScene:n}=await import("./index-D_ALOtkQ.js").then(l=>l.H);return{HallwayScene:n}},__vite__mapDeps([0,1,2]),import.meta.url),o=this.floor,h=this.roomNumber,r=class extends e{constructor(n){super(n),this.currentFloor=o,this.returnFromRoom=h}};await t.switchTo(r)}}onResize(){this.groundLevel=this.layout.roomHeight-this.platformHeight-20,this.container.removeChildren(),this.createRoomLayout(),this.createRoomElements(),this.createPlayer(),this.createNPC(),this.createUI(),this.positionElements(),this.isShowingDialog&&this.hideDialog()}}export{x as RoomScene};
//# sourceMappingURL=RoomScene-BB3RCdNY.js.map
